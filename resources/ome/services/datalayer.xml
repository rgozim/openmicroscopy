<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"
       default-lazy-init="true">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
#
# Copyright 2006 University of Dundee. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore <josh.moore@gmx.de>
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->

  <description>
    Configuration for standalone properties and general database access.
    The beans in this configuration file should NOT be generally accessed.
    In general, this entire file should be considered to have a "private" scope.
  </description>

  <!--  Scope: private -->

  <bean id="transactionManager" lazy-init="true"
        class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <description>
    Scope: private
    </description>
    <constructor-arg ref="dataSource"/>
  </bean>

  <bean id="transactionHandler"
        class="org.springframework.transaction.interceptor.TransactionInterceptor">
    <description>
    Scope: private
    </description>
    <property name="transactionManager" ref="transactionManager"/>
    <property name="transactionAttributeSource">
      <bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
    </property>
  </bean>

  <bean id="unsafeJdbcTemplate" class="org.springframework.jdbc.core.simple.SimpleJdbcTemplate">
    <description>
    Scope: private
    
    This template is "unsafe" since it does not take part Hibernate transactions
    and should only be used in cases where this is beneficial.
    </description>
    <constructor-arg ref="dataSource"/>
  </bean>

  <bean id="lobHandler" class="org.springframework.jdbc.support.lob.DefaultLobHandler"/>

  <!--
    DATA SOURCES
   -->

  <!-- To re-activate data source testing (see test/ome/server/itests/scalability)
  use the alias with ${dataSource} and define a dataSource property either in
  a configuration file, or directly in your tests via System.setProperty() *before*
  creating the Spring application context. -->
  <!--alias name="${dataSource}" alias="dataSource"/-->
  <alias name="c3p0DataSource" alias="dataSource"/>
  <bean id="c3p0DataSource" lazy-init="true"
     class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close">
    <description>
    Scope: private
    </description>
    <property name="driverClass" value="${hibernate.connection.driver_class}"/>
    <property name="jdbcUrl" value="${hibernate.connection.url}"/>
    <property name="user" value="${hibernate.connection.username}"/>
    <property name="password" value="${hibernate.connection.password}"/>
  </bean>

  <!-- Alternative data sources, used for testing -->
  <bean id="dbcpDataSource" class="org.apache.commons.dbcp.BasicDataSource">
      <property name="driverClassName" value="${hibernate.connection.driver_class}"/>
      <property name="url" value="${hibernate.connection.url}"/>
      <property name="username" value="${hibernate.connection.username}"/>
      <property name="password" value="${hibernate.connection.password}"/>
  </bean>

  <bean id="pgSimpleDataSource" class="org.postgresql.jdbc2.optional.SimpleDataSource">
      <property name="serverName" value="${database.host}"/>
      <property name="databaseName" value="${database.name}"/>
      <property name="user" value="${hibernate.connection.username}"/>
      <property name="password" value="${hibernate.connection.password}"/>
  </bean>

  <bean id="springSingleDataSource" class="org.springframework.jdbc.datasource.SingleConnectionDataSource">
      <property name="driverClassName" value="${hibernate.connection.driver_class}"/>
      <property name="url" value="${hibernate.connection.url}"/>
      <property name="username" value="${hibernate.connection.username}"/>
      <property name="password" value="${hibernate.connection.password}"/>
      <property name="suppressClose" value="true"/>
  </bean>

</beans>
