<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >

<hibernate-mapping>

<!--

    Copyright 2007 Glencoe Software, Inc. All rights reserved.
    Use is subject to license terms supplied in LICENSE.txt
 
    As opposed to the Hibernate mapping files generated by the 
    dsl, this mapping file contains an entire class hierarchy
    which will all be contained in one table and is managed
    by hand.

-->

<class name="ome.model.attributes.Attribute" 
       table="attribute"
       abstract="true"
       select-before-update="true"
>
    <meta attribute="extra-import">ome.model.IObject</meta>
    <meta attribute="extra-import">java.util.*</meta>
    <meta attribute="implement-equals">false</meta>

    <meta attribute="class-code">
        public final static String OWNER_FILTER = "attribute_owner_filter";
        public final static String GROUP_FILTER = "attribute_group_filter";
        public final static String EVENT_FILTER = "attribute_event_filter";
        public final static String PERMS_FILTER = "attribute_perms_filter";
    </meta>
    
    <meta attribute="class-code">
         // See dsl/resources/ome/dsl/mapping.vm for more information
         private static final long serialVersionUID = 0000000030000010301L;
    </meta>
    <meta attribute="implements">ome.model.IMutable</meta>
    <meta attribute="implements">ome.model.IAttribute</meta>

    <id name="id" type="java.lang.Long" column="id">
        <meta attribute="setter-scope">protected</meta>
        <generator class="sequence">
          <param name="sequence">seq_attribute</param>
        </generator>
    </id>

    <discriminator column="class" type="string"/>

    <component name="details" class="ome.model.internal.Details">
        <meta attribute="default-value">new Details()</meta>
        <many-to-one name="owner" class="ome.model.meta.Experimenter"
            column="owner_id" not-null="true" cascade="lock,merge,persist,replicate,refresh,save-update"/>
        <many-to-one name="group" class="ome.model.meta.ExperimenterGroup"
            column="group_id" not-null="true" cascade="lock,merge,persist,replicate,refresh,save-update"/>
        <many-to-one name="creationEvent" class="ome.model.meta.Event"
            column="creation_id" update="false"
            not-null="true" cascade="lock,merge,persist,replicate,refresh,save-update"/>
        <many-to-one name="updateEvent" class="ome.model.meta.Event"
            column="update_id" update="true"
            not-null="true" cascade="lock,merge,persist,replicate,refresh,save-update"/>

        <component name="permissions" class="ome.model.internal.Permissions">
            <meta attribute="default-value">new Permissions(Permissions.DEFAULT)</meta>
            <property name="perm1" not-null="true"
                type="long" column="permissions"/>
        </component>

        <!-- ??? -->
        <many-to-one name="externalInfo" class="ome.model.meta.ExternalInfo"
            column="external_id" not-null="false" unique="true"
            cascade="lock,merge,persist,replicate,refresh,save-update,delete"/>

    </component>

    <property name="version" type="java.lang.Integer">
        <meta attribute="default-value">new Integer(0)</meta>
        <column name="version" default="0"/>
    </property>

    <many-to-one
        name="reference"
        class="ome.model.meta.ExternalInfo"
        column="reference"
        not-null="false"
        unique="false"
        cascade="lock,merge,persist,replicate,refresh,save-update"
        insert="true"
        update="true"
     >
     </many-to-one>

    <subclass name="ome.model.attributes.StringAttribute">
        <property name="content" column="string"/>
    </subclass>

    <subclass name="ome.model.attributes.LongAttribute">
         <property name="long" column="long"/>
    </subclass>

    <subclass name="ome.model.attributes.FileAttribute">
        <many-to-one
            name="file"
            class="ome.model.meta.OriginalFile"
            column="file"
            not-null="false"
            unique="false"
            cascade="lock,merge,persist,replicate,refresh,save-update"
            insert="true"
            update="true"
     >
     </many-to-one>

    </subclass>

    <!-- See the comments on filters below -->
    <filter name="attribute_owner_filter" condition=":ownerId = owner_id"/>
    <filter name="attribute_group_filter" condition=":groupId = group_id"/>
    <filter name="attribute_event_filter" condition=":eventId = event_id"/>
    <filter name="attribute_perms_filter" condition=":permsStr = permissions"/>
    <filter name="securityFilter"/>

</class>

<filter-def name="attribute_owner_filter">
  <filter-param type="java.lang.Long" name="ownerId"/>
</filter-def>

<filter-def name="attribute_group_filter">
  <filter-param type="java.lang.Long" name="groupId"/>
</filter-def>

<filter-def name="attribute_event_filter">
  <filter-param type="java.lang.Long" name="eventId"/>
</filter-def>

<filter-def name="attribute_perms_filter">
  <filter-param type="java.lang.String" name="permsStr"/>
</filter-def>

</hibernate-mapping>
