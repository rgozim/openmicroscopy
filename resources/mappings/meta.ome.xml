<?xml version="1.0" encoding="UTF-8"?>
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# Copyright (C) 2005 Open Microscopy Environment
#       Massachusetts Institue of Technology,
#       National Institutes of Health,
#       University of Dundee
#
#
#
#    This library is free software; you can redistribute it and/or
#    modify it under the terms of the GNU Lesser General Public
#    License as published by the Free Software Foundation; either
#    version 2.1 of the License, or (at your option) any later version.
#
#    This library is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#    Lesser General Public License for more details.
#
#    You should have received a copy of the GNU Lesser General Public
#    License along with this library; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->
<types>
	
	<!-- MANAGEMENT -->
	<type id="ome.model.meta.ExperimenterGroup" described="true">
		<properties>
      <!-- TODO unqiuelynamed=true? -->
      <required name="name" type="string" unique="true"/>
			<child name="groupExperimenterMap" type="ome.model.meta.GroupExperimenterMap"
        target="ome.model.meta.Experimenter"/>
		</properties>
	</type>
	
	<type id="ome.model.meta.Experimenter" global="true">
		<!-- ## needs to be ome_name -->
		<properties>
			<parent name="groupExperimenterMap" type="ome.model.meta.GroupExperimenterMap"
        target="ome.model.meta.ExperimenterGroup"/>
			<required name="omeName" type="string" unique="true"/>
			<required name="firstName" type="string"/>
			<optional name="middleName" type="string"/>
			<required name="lastName" type="string"/>
			<optional name="institution" type="string"/>
			<component id="ome.model.internal.Email" required="false">
				<optional name="email" type="string"/>
			</component>
			<onemany name="defaultGroupLink" type="ome.model.meta.GroupExperimenterMap" tag="defaultGroupLink"/>       
			<!-- ## add to dsl [email/] -->		
		</properties>
	</type>
	
	<link id="ome.model.meta.GroupExperimenterMap">
		<properties>
			<from_parent type="ome.model.meta.ExperimenterGroup"/>
			<to_child type="ome.model.meta.Experimenter" tag="defaultGroupLink"/>
		</properties>
	</link>
	
	<!-- EVENTS -->
	<enum id="ome.model.enums.EventType">
		<entry name="Import"/>
		<entry name="Internal"/>
		<entry name="Shoola"/>
		<entry name="User"/>
		<entry name="Test"/>
	</enum>

	<type id="ome.model.meta.Event" mutable="false" global="true">
		<properties>
      <!-- Type & Group are not really optional. Needed to bootstrap.
        Constraints are added later -->
			<optional name="status" type="string"/>
			<required name="time" type="timestamp"/>
			<required name="experimenter" type="ome.model.meta.Experimenter"/>
			<optional name="experimenterGroup" type="ome.model.meta.ExperimenterGroup"/>
			<optional name="type" type="ome.model.enums.EventType"/>
			<optional name="containingEvent" type="ome.model.meta.Event"/>
			<onemany  name="logs" type="ome.model.meta.EventLog" inverse="event"/>
		</properties>
	</type>    

	<type id="ome.model.meta.EventLog" mutable="false" global="true">
		<properties>
			<required name="entityId" type="long"/>
			<required name="entityType" type="string"/>
			<required name="action" type="string"/>
			<manyone name="event" type="ome.model.meta.Event"/>
		</properties>
	</type>
	
	<type id="ome.model.meta.ExternalInfo" global="true">
		<properties>
			<required name="entityId" type="long"/>
			<required name="entityType" type="string"/>
			<required name="lsid" type="string"/>
		</properties>
	</type>

</types>
