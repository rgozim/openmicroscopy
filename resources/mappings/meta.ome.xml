<?xml version="1.0" encoding="UTF-8"?>
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# 
# $Id$
# 
# Copyright 2006 University of Dundee. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-->
<types>
	
	<!-- MANAGEMENT -->
	<type id="ome.model.meta.ExperimenterGroup" described="true">
		<properties>
      <!-- TODO unqiuelynamed=true? -->
      <required name="name" type="string" unique="true"/>
			<child name="groupExperimenterMap" type="ome.model.meta.GroupExperimenterMap"
        target="ome.model.meta.Experimenter"/>
		</properties>
	</type>
	
	<type id="ome.model.meta.Experimenter" global="true" annotated="true">
		<!-- ## needs to be ome_name -->
		<properties>
			<parent name="groupExperimenterMap" ordered="true" 
				type="ome.model.meta.GroupExperimenterMap"
				target="ome.model.meta.ExperimenterGroup"/>
			<required name="omeName" type="string" unique="true"/>
			<required name="firstName" type="string"/>
			<optional name="middleName" type="string"/>
			<required name="lastName" type="string"/>
			<optional name="institution" type="string"/>
			<component id="ome.model.internal.Email" required="false">
				<optional name="email" type="string"/>
			</component>
			<!-- ## add to dsl [email/] -->		
		</properties>
	</type>
	
	<link id="ome.model.meta.GroupExperimenterMap">
		<properties>
			<from_parent type="ome.model.meta.ExperimenterGroup"/>
			<to_child type="ome.model.meta.Experimenter" ordered="true"/>
		</properties>
	</link>
	
	<!-- EVENTS -->
	<enum id="ome.model.enums.EventType">
		<entry name="Import"/>
		<entry name="Internal"/>
		<entry name="Shoola"/>
		<entry name="User"/>
		<entry name="Task"/>
		<entry name="Test"/>
		<entry name="Processing"/>
	</enum>

	<type id="ome.model.meta.Event" immutable="true" global="true">
		<properties>
      <!-- Type & Group are not really optional. Needed to bootstrap.
        Constraints are added later -->
			<optional name="status" type="string"/>
			<required name="time" type="timestamp"/>
			<required name="experimenter" type="ome.model.meta.Experimenter"/>
			<optional name="experimenterGroup" type="ome.model.meta.ExperimenterGroup"/>
			<optional name="type" type="ome.model.enums.EventType"/>
			<optional name="containingEvent" type="ome.model.meta.Event"/>
			<onemany  name="logs" type="ome.model.meta.EventLog" inverse="event"/>
		</properties>
	</type>    

	<type id="ome.model.meta.EventLog" immutable="true" global="true">
		<properties>
			<required name="entityId" type="long"/>
			<required name="entityType" type="string"/>
			<required name="action" type="string"/>
			<manyone name="event" type="ome.model.meta.Event"/>
		</properties>
	</type>
	
	<type id="ome.model.meta.ExternalInfo" immutable="true">
		<properties>
			<required name="entityId" type="long" mutable="false"/>
			<required name="entityType" type="string" mutable="false"/>
			<required name="lsid" type="string" mutable="false"/>
		</properties>
	</type>

	<type id="ome.model.meta.DBPatch" immutable="true" global="true">
		<properties>
			<required name="currentVersion"  type="string"     mutable="false"/>
			<required name="currentPatch"    type="int"        mutable="false"/>
			<required name="previousVersion" type="string"     mutable="false"/>
			<required name="previousPatch"   type="int"        mutable="false"/>
			<optional name="finished"        type="timestamp"  mutable="false"/>
			<optional name="message"         type="string"     mutable="false"/>
		</properties>
	</type>

</types>
