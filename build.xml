<?xml version="1.0" encoding="utf-8"?>
<project name="services" default="install" basedir=".">

	<property name="classpath.file" value="classpath.xml"/>
	<import file="${classpath.file}"/>

        <target name="reload-db" depends="prepare,load-groovy">
                <groovy>
		        import ome.security.PasswordUtil
                        rootpass=properties["omero.rootpass"]
                        rootpass=PasswordUtil.preparePassword(rootpass)
                        properties["ROOTPASS"]=rootpass
                </groovy>
		<copy file="${sql.dir}/ddl.sql" todir="${target.dir}"/>
		<copy file="${sql.dir}/data.sql" todir="${target.dir}"/>
                <replace file="${target.dir}/data.sql" token="@ROOTPASS@" value="${ROOTPASS}"/>
                <sql_run>
                        <transaction src="${target.dir}/ddl.sql"/>
                        <transaction src="${target.dir}/data.sql"/>
                </sql_run>
        </target>

</project>
