<?xml version="1.0" encoding="utf-8"?>
<project name="services" default="install" basedir=".">

	<property name="classpath.file" value="classpath.xml"/>
	<import file="${classpath.file}"/>

        <target name="reload-db" depends="prepare">
                <java classname="ome.security.PasswordUtil" outputproperty="ROOTPASS" classpathref="omero.classpath">
		    <arg value="${omero.rootpass}"/>
		</java>
		<copy file="${sql.dir}/ddl.sql" todir="${target.dir}"/>
		<copy file="${sql.dir}/data.sql" todir="${target.dir}"/>
                <replace file="${target.dir}/data.sql" token="@ROOTPASS@" value="${ROOTPASS}"/>
                <sql_run>
                        <transaction src="${target.dir}/ddl.sql"/>
                        <transaction src="${target.dir}/data.sql"/>
                </sql_run>
        </target>

	<target name="compile" depends="generate">
		<hard-wire file="ome/logic/AbstractBean.java"/>
		<myjavac>
		  <src path="${src.dir}"/>
		</myjavac>
		<delete file="${classes.dir}/ome/logic/AbstractBean.class"/>
		<myjavac>
		  <src path="${src.dest}"/>
		</myjavac>
		<delete file="${src.dest}/ome/logic/AbstractBean.java"/>
	</target>

</project>
